# Visualization & HTML Reports

이 문서는 프로파일 결과를 시각화하고 HTML 리포트를 생성하는 시스템을 설명합니다.

## 개요

`src/truthound/profiler/visualization.py`에 구현된 시각화 시스템은 순수 SVG 기반 차트 렌더링과 HTML 리포트 생성을 제공합니다.

## ChartType

```python
class ChartType(Enum):
    """차트 유형"""

    BAR = "bar"                     # 막대 차트
    HORIZONTAL_BAR = "horizontal_bar"  # 수평 막대 차트
    PIE = "pie"                     # 파이 차트
    DONUT = "donut"                 # 도넛 차트
    LINE = "line"                   # 라인 차트
    AREA = "area"                   # 영역 차트
    SCATTER = "scatter"             # 산점도
    HISTOGRAM = "histogram"         # 히스토그램
    HEATMAP = "heatmap"             # 히트맵
    TABLE = "table"                 # 테이블
    GAUGE = "gauge"                 # 게이지 차트
    SPARKLINE = "sparkline"         # 스파크라인
    TREEMAP = "treemap"             # 트리맵
    SANKEY = "sankey"               # 산키 다이어그램
```

## ReportTheme

```python
class ReportTheme(Enum):
    """리포트 테마"""

    LIGHT = "light"               # 밝은 테마
    DARK = "dark"                 # 어두운 테마
    PROFESSIONAL = "professional" # 전문가용 테마
    MINIMAL = "minimal"           # 미니멀 테마
    COLORFUL = "colorful"         # 다채로운 테마
```

## SectionType

```python
class SectionType(Enum):
    """리포트 섹션 유형"""

    OVERVIEW = "overview"               # 개요 섹션
    COLUMN_DETAILS = "column_details"   # 컬럼 상세
    DATA_QUALITY = "data_quality"       # 데이터 품질
    STATISTICS = "statistics"           # 통계 정보
    PATTERNS = "patterns"               # 패턴 정보
    ALERTS = "alerts"                   # 알림
    RECOMMENDATIONS = "recommendations" # 권장사항
    CUSTOM = "custom"                   # 커스텀 섹션
```

## SVGChartRenderer

외부 의존성 없이 순수 SVG로 차트를 렌더링합니다. ChartData와 ChartConfig를 사용하여 통합된 인터페이스를 제공합니다.

```python
from truthound.profiler.visualization import (
    SVGChartRenderer, ChartData, ChartConfig, ChartType
)

renderer = SVGChartRenderer()

# 막대 차트
bar_data = ChartData(
    labels=["A", "B", "C", "D", "E"],
    values=[10, 25, 15, 30, 20],
    title="Distribution",
)
bar_config = ChartConfig(chart_type=ChartType.BAR, width=400, height=300)
bar_svg = renderer.render(bar_data, bar_config)

# 파이 차트
pie_data = ChartData(
    labels=["Cat A", "Cat B", "Cat C", "Cat D", "Cat E"],
    values=[30, 25, 20, 15, 10],
)
pie_config = ChartConfig(chart_type=ChartType.PIE, width=300, height=300)
pie_svg = renderer.render(pie_data, pie_config)

# 히스토그램
hist_data = ChartData(
    labels=["0-10", "10-20", "20-30", "30-40"],
    values=[5, 12, 8, 3],
    title="Value Distribution",
)
hist_config = ChartConfig(chart_type=ChartType.HISTOGRAM, width=400, height=300)
hist_svg = renderer.render(hist_data, hist_config)

# 게이지 차트
gauge_data = ChartData(
    values=[85],  # 현재 값
    title="Completeness",
    metadata={"min": 0, "max": 100},
)
gauge_config = ChartConfig(chart_type=ChartType.GAUGE, width=250, height=180)
gauge_svg = renderer.render(gauge_data, gauge_config)
```

## HTMLReportGenerator

전체 HTML 리포트를 생성합니다. ProfileData 객체나 dict를 입력으로 받습니다.

```python
from truthound.profiler.visualization import (
    HTMLReportGenerator, ReportConfig, ReportTheme, ProfileData
)

# 설정
config = ReportConfig(
    title="Data Profile Report",
    subtitle="Generated by Truthound",
    theme=ReportTheme.PROFESSIONAL,
    include_toc=True,
    include_timestamp=True,
    include_summary=True,
    sections=[
        SectionType.OVERVIEW,
        SectionType.DATA_QUALITY,
        SectionType.COLUMN_DETAILS,
        SectionType.PATTERNS,
        SectionType.RECOMMENDATIONS,
    ],
)

# 리포트 생성
generator = HTMLReportGenerator()
html = generator.generate(profile_data, config)

# 파일로 저장
generator.save(profile_data, "report.html", config)

# dict에서 생성
html = generator.generate_from_dict(profile_dict, config)
```

## ReportConfig

```python
@dataclass
class ReportConfig:
    """리포트 설정"""

    title: str = "Data Profile Report"
    subtitle: str = ""
    theme: ReportTheme = ReportTheme.LIGHT
    logo_path: str | None = None        # 로고 파일 경로
    logo_base64: str | None = None      # base64 인코딩된 로고
    include_toc: bool = True            # 목차 포함
    include_timestamp: bool = True      # 타임스탬프 포함
    include_summary: bool = True        # 요약 포함
    sections: list[SectionType] = field(default_factory=lambda: [
        SectionType.OVERVIEW,
        SectionType.DATA_QUALITY,
        SectionType.COLUMN_DETAILS,
        SectionType.PATTERNS,
        SectionType.RECOMMENDATIONS,
    ])
    custom_css: str | None = None       # 커스텀 CSS
    custom_js: str | None = None        # 커스텀 JavaScript
    embed_resources: bool = True        # 리소스 임베딩
    language: str = "en"                # 언어 코드
```

## 섹션 렌더러

각 섹션은 별도의 렌더러(SectionRenderer 프로토콜 구현)로 생성됩니다. 렌더러는 SectionContent, ChartRenderer, ThemeConfig를 입력으로 받습니다.

### OverviewSectionRenderer

```python
from truthound.profiler.visualization import (
    OverviewSectionRenderer, SectionContent, SectionType
)

renderer = OverviewSectionRenderer()
content = SectionContent(
    section_type=SectionType.OVERVIEW,
    title="Overview",
    text_blocks=["Table: users", "Rows: 10,000 | Columns: 5"],
    charts=[...],
    tables=[...],
)
html = renderer.render(content, chart_renderer, theme)
```

### DataQualitySectionRenderer

```python
from truthound.profiler.visualization import DataQualitySectionRenderer

renderer = DataQualitySectionRenderer()
# 포함 내용:
# - 품질 게이지 차트
# - 알림/경고 표시
# - 컬럼별 품질 테이블
```

### ColumnDetailsSectionRenderer

```python
from truthound.profiler.visualization import ColumnDetailsSectionRenderer

renderer = ColumnDetailsSectionRenderer()
# 각 컬럼별:
# - 값 분포 차트 (BAR 또는 HISTOGRAM)
# - 컬럼 통계 테이블
# - 접기/펼치기 지원 (collapsible=True)
```

### PatternsSectionRenderer

```python
from truthound.profiler.visualization import PatternsSectionRenderer

renderer = PatternsSectionRenderer()
# 포함 내용:
# - 패턴 유형 파이 차트
# - 패턴 상세 테이블
```

### RecommendationsSectionRenderer

```python
from truthound.profiler.visualization import RecommendationsSectionRenderer

renderer = RecommendationsSectionRenderer()
# 포함 내용:
# - 권장사항 목록 (text_blocks)
# - 추가 정보 테이블
```

## ReportExporter

다양한 형식으로 내보내기를 지원합니다. HTML과 JSON 형식을 기본 지원합니다.

```python
from truthound.profiler.visualization import ReportExporter, ProfileData

exporter = ReportExporter()

# HTML 내보내기
html_str = exporter.to_html(profile_data, config)

# JSON 내보내기
json_str = exporter.to_json(profile_data)

# 파일로 내보내기
exporter.to_file(profile_data, "report.html", format="html")
exporter.to_file(profile_data, "profile.json", format="json")
```

## 테마 커스터마이징

ThemeConfig로 커스텀 테마를 생성하거나 ThemeRegistry에 등록할 수 있습니다.

```python
from truthound.profiler.visualization import ThemeConfig, theme_registry, HTMLReportGenerator

custom_theme = ThemeConfig(
    name="my_theme",
    primary_color="#3498db",
    secondary_color="#2ecc71",
    accent_color="#e74c3c",
    background_color="#ffffff",
    text_color="#333333",
    border_color="#e0e0e0",
    font_family="'Noto Sans KR', sans-serif",
    header_bg="#f8f9fa",
    card_bg="#ffffff",
    shadow="0 2px 4px rgba(0,0,0,0.1)",
    border_radius="8px",
)

# 레지스트리에 등록
theme_registry.register("my_theme", custom_theme)

# 테마를 직접 전달
generator = HTMLReportGenerator(theme=custom_theme)
```

## 차트 렌더링 방식

| 출력 형식 | 차트 엔진 | 특징 |
|-----------|-----------|------|
| HTML | ApexCharts | 인터랙티브, JS 필요 |
| PDF | SVG (순수) | JS 의존성 없음, 정적 |
| Markdown | 텍스트 | 아스키 아트 차트 |

```python
# HTML용 인터랙티브 차트
html_generator = HTMLReportGenerator(config)
html = html_generator.generate(profile)  # ApexCharts 사용

# PDF용 정적 SVG 차트
pdf_exporter = ReportExporter()
pdf_exporter.export(profile, "report.pdf")  # 순수 SVG 사용
```

## 빠른 리포트 생성

```python
from truthound.profiler.visualization import generate_report

# 간편 함수
html = generate_report(profile)
with open("report.html", "w") as f:
    f.write(html)

# 테마 지정
html = generate_report(profile, theme=ReportTheme.DARK)
```

## 비교 리포트

여러 프로파일을 비교하는 리포트를 생성합니다.

```python
from truthound.profiler.visualization import compare_profiles

# 여러 프로파일 비교
html = compare_profiles(
    profiles=[profile1, profile2, profile3],
    labels=["Before", "After", "Latest"],
    config=ReportConfig(title="Profile Comparison Report"),
)

# 포함 내용:
# - 프로파일 개요 비교 테이블 (테이블명, 행수, 컬럼수)
# - 품질 점수 비교 막대 차트
```

## CLI 사용법

```bash
# HTML 리포트 생성
th profile data.csv --output report.html --format html

# 테마 지정
th profile data.csv --output report.html --theme dark

# PDF 리포트 생성
th profile data.csv --output report.pdf --format pdf

# 비교 리포트
th compare-profiles profile1.json profile2.json --output comparison.html
```

## 다음 단계

- [국제화](i18n.md) - 다국어 리포트 생성
- [분산 처리](distributed.md) - 대규모 리포트 병렬 생성

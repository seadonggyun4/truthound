# 다국어 지원 (i18n)

Truthound는 검증기 에러 메시지의 국제화를 위한 엔터프라이즈급 i18n 시스템을 제공합니다.

## 지원 언어

### 기본 언어 (7개)

| 코드 | 언어 | 방향 |
|------|------|------|
| `en` | English | LTR |
| `ko` | 한국어 | LTR |
| `ja` | 日本語 | LTR |
| `zh` | 中文 | LTR |
| `de` | Deutsch | LTR |
| `fr` | Français | LTR |
| `es` | Español | LTR |

### 확장 언어 (8개)

| 코드 | 언어 | 방향 | 비고 |
|------|------|------|------|
| `pt` | Português | LTR | |
| `pt-BR` | Português (Brasil) | LTR | 브라질 |
| `pt-PT` | Português (Portugal) | LTR | 포르투갈 |
| `it` | Italiano | LTR | |
| `ru` | Русский | LTR | |
| `ar` | العربية | RTL | |
| `he` | עברית | RTL | |
| `fa` | فارسی | RTL | |

---

## 기본 사용법

### 로케일 설정

```python
from truthound.validators.i18n import (
    set_validator_locale,
    get_validator_locale,
)

# 로케일 설정
set_validator_locale("ko")

# 현재 로케일 확인
locale = get_validator_locale()
print(locale)  # "ko"
```

### 메시지 조회

```python
from truthound.validators.i18n import (
    get_validator_message,
    ValidatorMessageCode,
)

# 로케일 설정
set_validator_locale("ko")

# 메시지 조회
msg = get_validator_message(
    ValidatorMessageCode.NULL_VALUES_FOUND,
    column="email",
    count=10,
)
print(msg)  # "'email' 컬럼에서 10개의 null 값이 발견되었습니다"
```

### 이슈 메시지 포맷팅

```python
from truthound.validators.i18n import format_issue_message
from truthound.validators.base import ValidationIssue

issue = ValidationIssue(
    column="email",
    issue_type="null_value",
    count=10,
    severity="high",
)

# 이슈 메시지 포맷팅
msg = format_issue_message(issue, locale="ko")
```

---

## ValidatorMessageCode

모든 검증기 메시지 코드:

### Completeness

| 코드 | 설명 |
|------|------|
| `NULL_VALUES_FOUND` | Null 값 발견 |
| `COMPLETENESS_BELOW_THRESHOLD` | 완전성 임계값 미달 |
| `REQUIRED_COLUMN_MISSING` | 필수 컬럼 누락 |

### Uniqueness

| 코드 | 설명 |
|------|------|
| `DUPLICATE_VALUES_FOUND` | 중복 값 발견 |
| `UNIQUENESS_CONSTRAINT_VIOLATED` | 고유성 제약 위반 |

### Range & Distribution

| 코드 | 설명 |
|------|------|
| `VALUES_OUT_OF_RANGE` | 범위 벗어난 값 |
| `MIN_VALUE_EXCEEDED` | 최솟값 미달 |
| `MAX_VALUE_EXCEEDED` | 최댓값 초과 |
| `OUTLIERS_DETECTED` | 이상치 감지 |

### Pattern & Format

| 코드 | 설명 |
|------|------|
| `PATTERN_MISMATCH` | 패턴 불일치 |
| `INVALID_EMAIL_FORMAT` | 잘못된 이메일 형식 |
| `INVALID_DATE_FORMAT` | 잘못된 날짜 형식 |
| `INVALID_PHONE_FORMAT` | 잘못된 전화번호 형식 |

### Type

| 코드 | 설명 |
|------|------|
| `TYPE_MISMATCH` | 타입 불일치 |
| `UNEXPECTED_TYPE` | 예상치 못한 타입 |

### Relationship

| 코드 | 설명 |
|------|------|
| `FOREIGN_KEY_VIOLATION` | 외래 키 위반 |
| `REFERENTIAL_INTEGRITY_ERROR` | 참조 무결성 오류 |

---

## CLDR 복수형 규칙

CLDR(Common Locale Data Repository) 표준 복수형 규칙 지원:

### 복수형 카테고리

| 카테고리 | 설명 | 예시 |
|----------|------|------|
| `zero` | 0 | 아랍어 0 |
| `one` | 단수 | 1 item |
| `two` | 쌍수 | 아랍어 2 |
| `few` | 소수 | 러시아어 2-4 |
| `many` | 다수 | 러시아어 5-20 |
| `other` | 기타 | 일반적 복수 |

### 복수형 사용

```python
from truthound.validators.i18n import (
    pluralize,
    get_plural_category,
    PluralCategory,
)

# 복수형 카테고리 확인
category = get_plural_category(5, "ru")
print(category)  # PluralCategory.FEW

# 복수형 메시지
msg = pluralize(
    count=5,
    forms={
        "one": "{count} файл",
        "few": "{count} файла",
        "many": "{count} файлов",
        "other": "{count} файлов",
    },
    locale="ru",
)
print(msg)  # "5 файлов"
```

### 언어별 복수형 규칙

| 언어 | 카테고리 | 규칙 |
|------|----------|------|
| 영어 | one, other | 1 = one, else other |
| 한국어 | other | 모두 other |
| 일본어 | other | 모두 other |
| 중국어 | other | 모두 other |
| 러시아어 | one, few, many, other | 복잡한 규칙 |
| 아랍어 | zero, one, two, few, many, other | 6개 형태 |
| 프랑스어 | one, other | 0, 1 = one, else other |
| 독일어 | one, other | 1 = one, else other |

---

## 숫자 및 날짜 포맷팅

### 숫자 포맷팅

```python
from truthound.validators.i18n import (
    format_number,
    format_currency,
    NumberStyle,
)

# 숫자 포맷팅
format_number(1234567.89, "de")   # "1.234.567,89"
format_number(1234567.89, "en")   # "1,234,567.89"
format_number(1234567.89, "ko")   # "1,234,567.89"
format_number(1234567.89, "ar")   # "١٬٢٣٤٬٥٦٧٫٨٩"

# 통화 포맷팅
format_currency(1000, "USD", "en")  # "$1,000.00"
format_currency(1000, "EUR", "de")  # "1.000,00 €"
format_currency(1000, "KRW", "ko")  # "₩1,000"
```

### 날짜 포맷팅

```python
from truthound.validators.i18n import (
    format_date,
    format_time,
    format_relative_time,
    DateStyle,
    TimeStyle,
)
from datetime import datetime, timedelta

now = datetime.now()

# 날짜 포맷팅
format_date(now, "ko", DateStyle.SHORT)   # "24. 12. 28."
format_date(now, "ko", DateStyle.MEDIUM)  # "2024. 12. 28."
format_date(now, "ko", DateStyle.LONG)    # "2024년 12월 28일"
format_date(now, "ko", DateStyle.FULL)    # "2024년 12월 28일 토요일"

format_date(now, "de", DateStyle.LONG)    # "28. Dezember 2024"
format_date(now, "ja", DateStyle.LONG)    # "2024年12月28日"

# 시간 포맷팅
format_time(now, "en", TimeStyle.SHORT)   # "3:30 PM"
format_time(now, "de", TimeStyle.SHORT)   # "15:30"
format_time(now, "ko", TimeStyle.MEDIUM)  # "오후 3:30:00"

# 상대 시간
format_relative_time(timedelta(days=-1), "ko")   # "어제"
format_relative_time(timedelta(hours=-3), "en")  # "3 hours ago"
format_relative_time(timedelta(days=2), "de")    # "in 2 Tagen"
```

---

## RTL 언어 지원

오른쪽에서 왼쪽(RTL) 언어 지원:

### RTL 언어 목록

```python
from truthound.validators.i18n import (
    RTL_LANGUAGES,
    is_rtl_language,
    get_locale_direction,
    TextDirection,
)

print(RTL_LANGUAGES)
# {"ar", "he", "fa", "ur", "yi", "ps", "sd", "dv", "ug", "ku"}

is_rtl_language("ar")  # True
is_rtl_language("ko")  # False

get_locale_direction("ar")  # TextDirection.RTL
get_locale_direction("en")  # TextDirection.LTR
```

### BiDi 처리

```python
from truthound.validators.i18n import (
    BiDiHandler,
    BiDiConfig,
    BiDiControl,
    wrap_bidi,
    detect_direction,
)

# 텍스트 방향 감지
direction = detect_direction("مرحبا")  # TextDirection.RTL
direction = detect_direction("Hello")  # TextDirection.LTR

# BiDi 핸들러
config = BiDiConfig(
    insert_marks=True,      # 방향 마커 삽입
    force_direction=None,   # 강제 방향 (None = 자동)
    isolate_numbers=True,   # 숫자 격리
    strip_marks=False,      # 기존 마커 제거
)

handler = BiDiHandler(config)
wrapped = handler.process("Hello مرحبا 123")

# 편의 함수
wrapped = wrap_bidi("Hello مرحبا", BiDiControl.LRI)
```

---

## 지역 방언 지원

### 방언 등록

```python
from truthound.validators.i18n import (
    create_dialect,
    register_dialect,
    get_dialect_registry,
    get_fallback_chain,
)

# 방언 생성
en_us = create_dialect(
    code="en-US",
    parent="en",
    name="English (United States)",
    overrides={
        ValidatorMessageCode.DATE_FORMAT_ERROR: "Invalid date format. Expected MM/DD/YYYY.",
    },
)

# 방언 등록
register_dialect(en_us)

# 폴백 체인 확인
chain = get_fallback_chain("en-US")
# ["en-US", "en"]

chain = get_fallback_chain("pt-BR")
# ["pt-BR", "pt"]
```

### 지역 설정

```python
from truthound.validators.i18n import set_validator_locale

# 지역 방언 설정
set_validator_locale("en-US")
set_validator_locale("zh-TW")  # 중국어 번체
set_validator_locale("pt-BR")  # 브라질 포르투갈어
```

---

## TMS 통합

번역 관리 시스템(TMS) 통합:

### 지원 TMS

| 프로바이더 | 클래스 | API |
|------------|--------|-----|
| Crowdin | `CrowdinProvider` | REST API v2 |
| Lokalise | `LokaliseProvider` | REST API v2 |
| Phrase | `PhraseProvider` | REST API v2 |

### TMS 설정

```python
from truthound.validators.i18n import (
    TMSConfig,
    TMSManager,
    create_provider,
    CrowdinProvider,
)

# Crowdin 설정
config = TMSConfig(
    provider="crowdin",
    api_key="your-api-key",
    project_id="your-project-id",
    base_url="https://api.crowdin.com/api/v2",
    sync_interval_seconds=3600,
    auto_sync=True,
)

# 프로바이더 생성
provider = create_provider(config)

# 또는 직접 생성
provider = CrowdinProvider(
    api_key="your-api-key",
    project_id="your-project-id",
)
```

### TMS 매니저

```python
from truthound.validators.i18n import get_tms_manager

manager = get_tms_manager(config)

# 번역 동기화
await manager.sync()

# 번역 상태 확인
status = await manager.get_translation_status("ko")
print(status.progress_percentage)
print(status.translated_count)
print(status.approved_count)

# 웹훅 처리
event = manager.parse_webhook(request_body)
if event.event_type == "translation.completed":
    await manager.sync()
```

---

## 동적 카탈로그 관리

### CatalogManager

```python
from truthound.validators.i18n import (
    CatalogManager,
    get_catalog_manager,
    FileSystemStorage,
    MemoryStorage,
)

# 메모리 스토리지 (기본)
manager = get_catalog_manager()

# 파일 시스템 스토리지
storage = FileSystemStorage(path="/translations")
manager = CatalogManager(storage=storage)

# 카탈로그 로드
catalog = manager.load_catalog("ko")

# 카탈로그 저장
manager.save_catalog("ko", catalog)

# 캐시 무효화
manager.invalidate_cache("ko")
manager.clear_cache()
```

### 컨텍스트 기반 메시지

```python
from truthound.validators.i18n import (
    ContextResolver,
    MessageContext,
    resolve_message,
)

# 컨텍스트 리졸버
resolver = ContextResolver()

# 컨텍스트별 메시지 조회
msg = resolve_message(
    code=ValidatorMessageCode.NULL_VALUES_FOUND,
    context=MessageContext.TECHNICAL,  # formal, informal, technical
    locale="ko",
    column="email",
    count=10,
)
```

---

## 커스텀 카탈로그

### 카탈로그 생성

```python
from truthound.validators.i18n import (
    ValidatorMessageCatalog,
    CatalogBuilder,
    create_custom_catalog,
)

# 빌더로 생성
builder = CatalogBuilder("custom")
builder.add_message(
    ValidatorMessageCode.NULL_VALUES_FOUND,
    "Column '{column}' contains {count} null values",
)
builder.add_message(
    ValidatorMessageCode.DUPLICATE_VALUES_FOUND,
    "Found {count} duplicate values in '{column}'",
)
catalog = builder.build()

# 편의 함수
catalog = create_custom_catalog(
    locale="custom",
    messages={
        ValidatorMessageCode.NULL_VALUES_FOUND: "Custom null message: {count}",
    },
    fallback="en",
)
```

### 카탈로그 등록

```python
from truthound.validators.i18n import get_catalog_manager

manager = get_catalog_manager()
manager.register_catalog("custom", catalog)

# 사용
set_validator_locale("custom")
msg = get_validator_message(ValidatorMessageCode.NULL_VALUES_FOUND, count=5)
```

---

## 기존 카탈로그 조회

```python
from truthound.validators.i18n import (
    get_all_catalogs,
    get_all_extended_catalogs,
    get_supported_locales,
    get_extended_supported_locales,
    get_default_messages,
    get_korean_messages,
    get_japanese_messages,
    get_chinese_messages,
    get_german_messages,
    get_french_messages,
    get_spanish_messages,
    get_portuguese_messages,
    get_italian_messages,
    get_russian_messages,
    get_arabic_messages,
    get_hebrew_messages,
    get_persian_messages,
)

# 지원 로케일 목록
locales = get_supported_locales()
# ["en", "ko", "ja", "zh", "de", "fr", "es"]

extended = get_extended_supported_locales()
# ["pt", "pt-BR", "pt-PT", "it", "ru", "ar", "he", "fa"]

# 모든 카탈로그
all_catalogs = get_all_catalogs()
all_extended = get_all_extended_catalogs()

# 개별 카탈로그
en_messages = get_default_messages()
ko_messages = get_korean_messages()
ar_messages = get_arabic_messages()
```

---

## 다음 단계

- [커스텀 검증기](custom-validators.md) - SDK 기본 사용법
- [보안 가이드](security.md) - ReDoS 보호, SQL 인젝션 방지
- [내장 검증기](built-in.md) - 289개 내장 검증기 참조
